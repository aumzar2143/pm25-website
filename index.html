<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PM2.5 Thailand â€“ Research Dashboard PRO</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
font-family:sans-serif;
margin:0;
padding:20px;
background:#111;
color:white;
transition:0.5s;
}
.container{max-width:1100px;margin:auto;}
.card{
background:#1e1e1e;
padding:20px;
border-radius:20px;
margin-bottom:20px;
}
select,button{
padding:10px;
border-radius:10px;
border:none;
margin:5px;
}
button{
background:#ffcc00;
cursor:pointer;
font-weight:bold;
}
.big{
font-size:70px;
font-weight:bold;
}
</style>
</head>
<body>

<div class="container">

<h1>ğŸ‘‘ PM2.5 à¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸—à¸¢ â€“ PRO</h1>

<div class="card">
<select id="province"></select>
<button onclick="loadSelected()">à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
<button onclick="exportCSV()">Export CSV</button>
</div>

<div class="card">
<div class="big" id="aqi">--</div>
<div id="level"></div>
<div id="advice"></div>
</div>

<div class="card">
<h3>ğŸ“Š à¹à¸™à¸§à¹‚à¸™à¹‰à¸¡à¸¢à¹‰à¸­à¸™à¸«à¸¥à¸±à¸‡</h3>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h3>ğŸ”¥ Top 10 à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸„à¹ˆà¸²à¸à¸¸à¹ˆà¸™à¸ªà¸¹à¸‡à¸ªà¸¸à¸”</h3>
<div id="top10"></div>
</div>

</div>

<script>

const TOKEN="05dc64914ef2d1b7c4d2678a15450338e660ea53";

let stations=[];

function getLevel(aqi){
if(aqi<=50) return ["ğŸŸ¢ à¸”à¸µ","#2ecc71"];
if(aqi<=100) return ["ğŸŸ¡ à¸›à¸²à¸™à¸à¸¥à¸²à¸‡","#f1c40f"];
if(aqi<=150) return ["ğŸŸ  à¹€à¸£à¸´à¹ˆà¸¡à¸¡à¸µà¸œà¸¥à¸à¸£à¸°à¸—à¸š","#e67e22"];
if(aqi<=200) return ["ğŸ”´ à¸¡à¸µà¸œà¸¥à¸à¸£à¸°à¸—à¸š","#e74c3c"];
return ["ğŸŸ£ à¸­à¸±à¸™à¸•à¸£à¸²à¸¢à¸¡à¸²à¸","#8e44ad"];
}

function getAdvice(aqi){
if(aqi<=50) return "à¸—à¸³à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸à¸¥à¸²à¸‡à¹à¸ˆà¹‰à¸‡à¹„à¸”à¹‰à¸•à¸²à¸¡à¸›à¸à¸•à¸´";
if(aqi<=100) return "à¸à¸¥à¸¸à¹ˆà¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸„à¸§à¸£à¸¥à¸”à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸à¸¥à¸²à¸‡à¹à¸ˆà¹‰à¸‡";
if(aqi<=150) return "à¸„à¸§à¸£à¸ªà¸§à¸¡à¸«à¸™à¹‰à¸²à¸à¸²à¸ N95";
if(aqi<=200) return "à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸à¸¥à¸²à¸‡à¹à¸ˆà¹‰à¸‡";
return "à¸‡à¸”à¸­à¸­à¸à¸ˆà¸²à¸à¸šà¹‰à¸²à¸™ à¹ƒà¸Šà¹‰à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸Ÿà¸­à¸à¸­à¸²à¸à¸²à¸¨";
}

async function loadStations(){
let res=await fetch(`https://api.waqi.info/search/?keyword=thailand&token=${TOKEN}`);
let data=await res.json();
stations=data.data;

let select=document.getElementById("province");
stations.forEach(s=>{
let opt=document.createElement("option");
opt.value=s.station.name;
opt.text=s.station.name;
select.appendChild(opt);
});
loadTop10();
}

async function loadSelected(){
let name=document.getElementById("province").value;
let res=await fetch(`https://api.waqi.info/feed/${name}/?token=${TOKEN}`);
let data=await res.json();

if(data.status==="ok"){
let aqi=data.data.aqi;
document.getElementById("aqi").innerText=aqi;

let lvl=getLevel(aqi);
document.getElementById("level").innerText=lvl[0];
document.body.style.background=lvl[1];

document.getElementById("advice").innerText=getAdvice(aqi);

drawChart(data.data.forecast.daily.pm25);
}
}

function drawChart(forecast){
let labels=forecast.map(d=>d.day);
let values=forecast.map(d=>d.avg);

new Chart(document.getElementById("chart"),{
type:"line",
data:{labels:labels,datasets:[{label:"PM2.5",data:values}]}
});
}

function loadTop10(){
let sorted=[...stations].sort((a,b)=>b.aqi-a.aqi).slice(0,10);
let html="";
sorted.forEach((s,i)=>{
html+=`${i+1}. ${s.station.name} - ${s.aqi}<br>`;
});
document.getElementById("top10").innerHTML=html;
}

function exportCSV(){
let csv="Station,AQI\n";
stations.forEach(s=>{
csv+=`${s.station.name},${s.aqi}\n`;
});
let blob=new Blob([csv],{type:"text/csv"});
let link=document.createElement("a");
link.href=URL.createObjectURL(blob);
link.download="pm25_thailand.csv";
link.click();
}

loadStations();

</script>

</body>
</html>
