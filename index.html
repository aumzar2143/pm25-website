<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thailand PM2.5 Dashboard</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    font-family:'Prompt',sans-serif;
    background:#f4f6f9;
}

header{
    background:linear-gradient(90deg,#0d6efd,#198754);
    color:white;
    padding:15px;
    text-align:center;
    font-size:22px;
    font-weight:bold;
}

.container{
    padding:20px;
}

#map{
    height:400px;
    border-radius:10px;
    margin-bottom:20px;
}

.card{
    background:white;
    padding:15px;
    border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1);
    margin-bottom:20px;
}

select{
    padding:8px;
    border-radius:5px;
    border:1px solid #ccc;
}

table{
    width:100%;
    border-collapse:collapse;
}

th,td{
    padding:8px;
    border:1px solid #ddd;
    text-align:center;
}

th{
    background:#0d6efd;
    color:white;
}

.top10{
    background:#ffdddd;
}

#adviceBox{
    font-size:15px;
}
</style>
</head>

<body>

<header>
üìä Thailand PM2.5 Real-time Dashboard
</header>

<div class="container">

<div id="map"></div>

<div class="card">
<label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: </label>
<select id="provinceSelect">
<option value="all">-- ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
</select>
</div>

<div class="card">
<h3>üìà ‡∏Å‡∏£‡∏≤‡∏ü Top 10 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
<canvas id="pmChart"></canvas>
</div>

<div class="card">
<h3>üèÜ Top 10 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</h3>
<table>
<thead>
<tr>
<th>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
<th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
<th>PM2.5 (¬µg/m¬≥)</th>
</tr>
</thead>
<tbody id="topTable"></tbody>
</table>
</div>

<div class="card" id="adviceBox">
<h3>ü©∫ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h3>
<p id="adviceText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
</div>

</div>

<script>

// ======= ‡πÉ‡∏™‡πà API ‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ =======
const API_URL = "https://example.com/pm25.json"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô API ‡∏à‡∏£‡∏¥‡∏á

let map = L.map('map').setView([13.736717,100.523186],6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'¬© OpenStreetMap'
}).addTo(map);

let markers = [];
let allData = [];
let chart;

// ======= ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• =======
fetch(API_URL)
.then(res=>res.json())
.then(data=>{
    allData = data;
    initDashboard(data);
});

// ======= ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö =======
function initDashboard(data){

    data.sort((a,b)=>b.pm25-a.pm25);

    populateDropdown(data);
    renderMap(data);
    renderTop10(data);
    renderChart(data.slice(0,10));
    showAdvice(data[0].pm25);
    sendNotification(data[0].pm25);
}

// ======= Dropdown =======
function populateDropdown(data){
    const select = document.getElementById("provinceSelect");
    data.forEach(item=>{
        let option = document.createElement("option");
        option.value = item.province;
        option.textContent = item.province;
        select.appendChild(option);
    });

    select.addEventListener("change",()=>{
        if(select.value==="all"){
            renderMap(allData);
        }else{
            let filtered = allData.filter(p=>p.province===select.value);
            renderMap(filtered);
            showAdvice(filtered[0].pm25);
        }
    });
}

// ======= Map =======
function renderMap(data){

    markers.forEach(m=>map.removeLayer(m));
    markers=[];

    data.forEach(loc=>{
        let marker = L.circle([loc.lat,loc.lon],{
            radius:8000,
            color:getColor(loc.pm25)
        }).addTo(map)
        .bindPopup(`<b>${loc.province}</b><br>PM2.5: ${loc.pm25}`);
        markers.push(marker);
    });
}

// ======= Top 10 Table =======
function renderTop10(data){

    const tbody = document.getElementById("topTable");
    tbody.innerHTML="";

    data.slice(0,10).forEach((item,index)=>{
        let row = `
        <tr class="top10">
            <td>${index+1}</td>
            <td>${item.province}</td>
            <td>${item.pm25}</td>
        </tr>`;
        tbody.innerHTML+=row;
    });
}

// ======= Chart =======
function renderChart(top10){

    if(chart) chart.destroy();

    chart = new Chart(document.getElementById("pmChart"),{
        type:'bar',
        data:{
            labels:top10.map(d=>d.province),
            datasets:[{
                label:'PM2.5 ¬µg/m¬≥',
                data:top10.map(d=>d.pm25)
            }]
        }
    });
}

// ======= ‡∏™‡∏µ‡∏£‡∏∞‡∏î‡∏±‡∏ö =======
function getColor(pm){
    if(pm<=25) return "#4CAF50";
    if(pm<=50) return "#FFC107";
    if(pm<=75) return "#FF5722";
    return "#B71C1C";
}

// ======= ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏£‡∏°‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢ =======
function showAdvice(pm){

    let text="";

    if(pm<=25){
        text="‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥";
    }
    else if(pm<=50){
        text="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    }
    else if(pm<=75){
        text="‡∏Ñ‡∏ß‡∏£‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95 ‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
    }
    else{
        text="‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®";
    }

    document.getElementById("adviceText").innerText=text;
}

// ======= Notification =======
function sendNotification(pm){

    if(!("Notification" in window)) return;

    Notification.requestPermission().then(permission=>{
        if(permission==="granted" && pm>75){
            new Notification("‚ö† PM2.5 ‡∏™‡∏π‡∏á!",{
                body:"‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95"
            });
        }
    });
}

</script>

</body>
</html>
