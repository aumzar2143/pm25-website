<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PM2.5 Thailand ‚Äì Research Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
font-family: 'Prompt', sans-serif;
background: linear-gradient(135deg,#b31217,#e52d27);
margin:0;
padding:20px;
color:white;
text-align:center;
}
.container{
max-width:1000px;
margin:auto;
}
.card{
background:rgba(0,0,0,0.75);
padding:20px;
border-radius:20px;
margin-bottom:20px;
box-shadow:0 10px 25px rgba(0,0,0,0.4);
}
select,button{
padding:12px;
border-radius:10px;
border:none;
margin:5px;
font-size:16px;
}
button{
background:#ffcc00;
cursor:pointer;
font-weight:bold;
}
h1{
margin-bottom:10px;
}
.aqi{
font-size:70px;
font-weight:bold;
}
.level{
font-size:20px;
margin-top:10px;
}
.top10{
text-align:left;
}
.footer{
margin-top:20px;
font-size:14px;
opacity:0.8;
}
</style>
</head>
<body>

<div class="container">

<h1>üëë PM2.5 ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢ ‚Äì Research Dashboard</h1>

<div class="card">
<button onclick="useGPS()">üìç ‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô (GPS)</button>
<select id="provinceSelect" onchange="loadData()">
<option value="Bangkok">‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£</option>
<option value="Chiang Mai">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</option>
<option value="Chiang Rai">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢</option>
<option value="Lampang">‡∏•‡∏≥‡∏õ‡∏≤‡∏á</option>
<option value="Nan">‡∏ô‡πà‡∏≤‡∏ô</option>
<option value="Phayao">‡∏û‡∏∞‡πÄ‡∏¢‡∏≤</option>
<option value="Khon Kaen">‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</option>
<option value="Nakhon Ratchasima">‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤</option>
<option value="Chon Buri">‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</option>
<option value="Rayong">‡∏£‡∏∞‡∏¢‡∏≠‡∏á</option>
<option value="Songkhla">‡∏™‡∏á‡∏Ç‡∏•‡∏≤</option>
<option value="Phuket">‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</option>
</select>
</div>

<div class="card">
<div class="aqi" id="pmValue">--</div>
<div>¬µg/m¬≥</div>
<div class="level" id="levelText"></div>
</div>

<div class="card">
<h2>üìä ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô</h2>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h2>üî• 10 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
<div class="top10" id="top10"></div>
</div>

<div class="card">
<h2>üõ° ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏£‡∏°‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢</h2>
<div id="advice"></div>
</div>

<div class="footer">
‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: OpenAQ API | ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Å‡∏£‡∏°‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢ ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç
</div>

</div>

<script>

const provinceMap = {
"Bangkok":"‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£",
"Chiang Mai":"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
"Chiang Rai":"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢",
"Lampang":"‡∏•‡∏≥‡∏õ‡∏≤‡∏á",
"Nan":"‡∏ô‡πà‡∏≤‡∏ô",
"Phayao":"‡∏û‡∏∞‡πÄ‡∏¢‡∏≤",
"Khon Kaen":"‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô",
"Nakhon Ratchasima":"‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤",
"Chon Buri":"‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ",
"Rayong":"‡∏£‡∏∞‡∏¢‡∏≠‡∏á",
"Songkhla":"‡∏™‡∏á‡∏Ç‡∏•‡∏≤",
"Phuket":"‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï"
};

function getLevel(pm){
if(pm<=15) return "üü¢ ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ";
if(pm<=37) return "üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
if(pm<=50) return "üü† ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û";
if(pm<=90) return "üî¥ ‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û";
return "üü£ ‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏°‡∏≤‡∏Å";
}

function getAdvice(pm){
if(pm<=37)
return "‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥";
if(pm<=50)
return "‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢";
if(pm<=90)
return "‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á ‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95 ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á";
return "‡∏á‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£";
}

async function loadData(){
let province = document.getElementById("provinceSelect").value;
let response = await fetch(`https://api.openaq.org/v2/latest?country=TH&city=${province}&parameter=pm25`);
let data = await response.json();

if(data.results.length>0){
let pm = data.results[0].measurements[0].value;
document.getElementById("pmValue").innerText = pm;
document.getElementById("levelText").innerText = getLevel(pm);
document.getElementById("advice").innerText = getAdvice(pm);
}else{
document.getElementById("pmValue").innerText="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
}
loadChart(province);
loadTop10();
}

async function loadChart(province){
let response = await fetch(`https://api.openaq.org/v2/measurements?country=TH&city=${province}&parameter=pm25&limit=7`);
let data = await response.json();

let labels=[];
let values=[];
data.results.reverse().forEach(d=>{
labels.push(d.date.local.split("T")[0]);
values.push(d.value);
});

new Chart(document.getElementById("chart"),{
type:"line",
data:{labels:labels,datasets:[{label:"PM2.5",data:values}]}
});
}

async function loadTop10(){
let response = await fetch(`https://api.openaq.org/v2/latest?country=TH&parameter=pm25&limit=10&order_by=value&sort=desc`);
let data = await response.json();
let html="";
data.results.forEach((r,i)=>{
html+=`${i+1}. ${provinceMap[r.city]||r.city} - ${r.measurements[0].value} ¬µg/m¬≥ <br>`;
});
document.getElementById("top10").innerHTML=html;
}

function useGPS(){
navigator.geolocation.getCurrentPosition(async position=>{
let lat=position.coords.latitude;
let lon=position.coords.longitude;
let response = await fetch(`https://api.openaq.org/v2/locations?coordinates=${lat},${lon}&country=TH&radius=10000`);
let data = await response.json();
if(data.results.length>0){
let city=data.results[0].city;
document.getElementById("provinceSelect").value=city;
loadData();
}
});
}

loadData();

</script>

</body>
</html>
