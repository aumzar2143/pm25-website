<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PM2.5 Smart Monitor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    text-align:center;
    color:white;
    transition: background 0.5s;
    padding:20px;
}
.card{
    background:white;
    color:black;
    padding:25px;
    border-radius:20px;
    max-width:400px;
    margin:auto;
    box-shadow:0 10px 25px rgba(0,0,0,0.3);
}
button{
    padding:10px 15px;
    border:none;
    border-radius:10px;
    font-size:16px;
    margin-top:10px;
    cursor:pointer;
}
</style>
</head>
<body>

<h2>üå´ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö PM2.5 ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h2>

<div class="card">
    <div id="location">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î...</div>
    <div id="result">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
    <button onclick="init()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
</div>

<script>
const apiKey = "05dc64914ef2d1b7c4d2678a15450338e660ea53";

async function getPM25(lat, lon){
    try{
        const url = `https://api.waqi.info/feed/geo:${lat};${lon}/?token=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();

        if(data.status !== "ok") throw new Error("API error");

        const pm25 = data.data.iaqi.pm25?.v || 0;
        const city = data.data.city.name;

        let level = "";
        let advice = "";
        let bgColor = "";

        if(pm25 <= 25){
            level="‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ üòä";
            advice="‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥";
            bgColor="#2ecc71";
        }
        else if(pm25 <= 50){
            level="‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üòê";
            advice="‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô";
            bgColor="#f1c40f";
        }
        else if(pm25 <= 90){
            level="‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö üò∑";
            advice="‡∏Ñ‡∏ß‡∏£‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95 ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á";
            bgColor="#e67e22";
        }
        else{
            level="‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ üö®";
            advice="‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®";
            bgColor="#e74c3c";

            sendNotification(pm25);
        }

        document.body.style.background = bgColor;

        document.getElementById("location").innerHTML =
            `<strong>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</strong> ${city}`;

        document.getElementById("result").innerHTML =
            `<h1>${pm25} ¬µg/m¬≥</h1>
             <h3>${level}</h3>
             <p>${advice}</p>`;

    }catch(error){
        document.getElementById("result").innerHTML =
            `<p style="color:red;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‚ùå</p>`;
    }
}

function sendNotification(value){
    if(Notification.permission === "granted"){
        new Notification("‚ö†Ô∏è PM2.5 ‡∏™‡∏π‡∏á!",{
            body:`‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ${value} ¬µg/m¬≥ ‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á`,
        });
    }
}

function init(){
    if("geolocation" in navigator){
        navigator.geolocation.getCurrentPosition(position=>{
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            getPM25(lat, lon);
        },()=>{
            document.getElementById("location").innerHTML =
                "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ";
        });
    }else{
        document.getElementById("location").innerHTML =
            "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS";
    }

    if("Notification" in window){
        Notification.requestPermission();
    }
}

init();
</script>

</body>
</html>
