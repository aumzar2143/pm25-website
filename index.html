<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ‡¹ğŸ‡­ Thailand PM2.5 Professional Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--bg:#f4f6f9;
--card:#ffffff;
--text:#222;
--primary:#005bea;
}

.dark{
--bg:#0f172a;
--card:#1e293b;
--text:#f1f5f9;
--primary:#38bdf8;
}

body{
margin:0;
font-family:'Prompt',sans-serif;
background:var(--bg);
color:var(--text);
transition:0.3s;
}

header{
background:linear-gradient(90deg,#005bea,#00c6fb);
color:white;
padding:20px;
text-align:center;
font-weight:bold;
font-size:22px;
}

.container{
padding:15px;
max-width:1200px;
margin:auto;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:15px;
margin-bottom:20px;
}

.card{
background:var(--card);
padding:18px;
border-radius:15px;
box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

.big{
font-size:32px;
font-weight:bold;
}

button{
padding:8px 14px;
border:none;
border-radius:8px;
cursor:pointer;
background:var(--primary);
color:white;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:var(--primary);
color:white;
padding:10px;
}

td{
padding:8px;
border-bottom:1px solid #ddd;
text-align:center;
}

.rank1{background:#ff4d4d;color:white;}
.rank2{background:#ffa64d;}
.rank3{background:#ffe066;}

</style>
</head>

<body>

<header>
ğŸŒ« Thailand PM2.5 Monitoring System  
<div style="font-size:14px">à¸­à¸±à¸›à¹€à¸”à¸•: <span id="time"></span></div>
</header>

<div class="container">

<div style="text-align:right;margin-bottom:10px;">
<button onclick="toggleDark()">ğŸŒ™ / â˜€ï¸ Mode</button>
</div>

<div class="grid">
<div class="card">
<div>ğŸ“Š à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢à¸›à¸£à¸°à¹€à¸—à¸¨</div>
<div class="big" id="avg">--</div>
</div>

<div class="card">
<div>ğŸš¨ à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸ªà¸¹à¸‡à¸ªà¸¸à¸”</div>
<div class="big" id="maxProvince">--</div>
</div>

<div class="card">
<div>ğŸ“ˆ à¸„à¹ˆà¸²à¸ªà¸¹à¸‡à¸ªà¸¸à¸”</div>
<div class="big" id="maxValue">--</div>
</div>
</div>

<div class="card">
<h3>ğŸ† Top 10 à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸­à¸±à¸™à¸•à¸£à¸²à¸¢</h3>
<table>
<thead>
<tr>
<th>à¸­à¸±à¸™à¸”à¸±à¸š</th>
<th>à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</th>
<th>PM2.5</th>
</tr>
</thead>
<tbody id="topTable"></tbody>
</table>
</div>

<div class="card">
<h3>ğŸ“Š à¸à¸£à¸²à¸Ÿ Top 10</h3>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h3>ğŸ©º à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸ªà¸¸à¸‚à¸ à¸²à¸</h3>
<p id="advice"></p>
</div>

</div>

<script>

// à¹ƒà¸ªà¹ˆ API à¸ˆà¸£à¸´à¸‡
const API_URL="https://example.com/pm25.json";

let allData=[];
let chart;

fetch(API_URL)
.then(res=>res.json())
.then(data=>{
    allData=data.sort((a,b)=>b.pm25-a.pm25);
    initDashboard();
});

function initDashboard(){

    document.getElementById("time").innerText=
    new Date().toLocaleString();

    let avg=Math.round(allData.reduce((a,b)=>a+b.pm25,0)/allData.length);

    animateNumber("avg",avg);
    animateNumber("maxValue",allData[0].pm25);
    document.getElementById("maxProvince").innerText=allData[0].province;

    renderTop10();
    renderChart();
    showAdvice(allData[0].pm25);
}

function renderTop10(){
    let tbody=document.getElementById("topTable");
    tbody.innerHTML="";
    allData.slice(0,10).forEach((d,i)=>{
        let cls="";
        if(i===0) cls="rank1";
        if(i===1) cls="rank2";
        if(i===2) cls="rank3";

        tbody.innerHTML+=`
        <tr class="${cls}">
        <td>${i+1}</td>
        <td>${d.province}</td>
        <td>${d.pm25}</td>
        </tr>`;
    });
}

function renderChart(){
    const ctx=document.getElementById("chart").getContext("2d");
    let gradient=ctx.createLinearGradient(0,0,0,400);
    gradient.addColorStop(0,"#ff416c");
    gradient.addColorStop(1,"#ff4b2b");

    chart=new Chart(ctx,{
        type:'bar',
        data:{
            labels:allData.slice(0,10).map(d=>d.province),
            datasets:[{
                label:'PM2.5 Âµg/mÂ³',
                data:allData.slice(0,10).map(d=>d.pm25),
                backgroundColor:gradient
            }]
        }
    });
}

function showAdvice(pm){
    let text="";
    if(pm<=25) text="ğŸ˜Š à¸­à¸²à¸à¸²à¸¨à¸”à¸µ à¸—à¸³à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸à¸¥à¸²à¸‡à¹à¸ˆà¹‰à¸‡à¹„à¸”à¹‰";
    else if(pm<=50) text="ğŸ˜· à¸à¸¥à¸¸à¹ˆà¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸„à¸§à¸£à¸¥à¸”à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸à¸¥à¸²à¸‡à¹à¸ˆà¹‰à¸‡";
    else if(pm<=75) text="âš  à¸„à¸§à¸£à¸ªà¸§à¸¡à¸«à¸™à¹‰à¸²à¸à¸²à¸ N95";
    else text="ğŸš¨ à¸­à¸±à¸™à¸•à¸£à¸²à¸¢! à¸„à¸§à¸£à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸­à¸²à¸„à¸²à¸£à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸Ÿà¸­à¸à¸­à¸²à¸à¸²à¸¨";

    document.getElementById("advice").innerText=text;
}

function animateNumber(id,target){
    let el=document.getElementById(id);
    let start=0;
    let duration=1000;
    let step=Math.ceil(target/(duration/16));

    let interval=setInterval(()=>{
        start+=step;
        if(start>=target){
            start=target;
            clearInterval(interval);
        }
        el.innerText=start+" Âµg/mÂ³";
    },16);
}

function toggleDark(){
    document.body.classList.toggle("dark");
}

// Auto Refresh à¸—à¸¸à¸ 5 à¸™à¸²à¸—à¸µ
setInterval(()=>location.reload(),300000);

</script>

</body>
</html>
