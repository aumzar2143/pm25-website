<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Healthy Air Smart Monitor</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    text-align:center;
    transition: background 0.5s;
    color:white;
    padding:20px;
}
.container{
    max-width:420px;
    margin:auto;
}
.card{
    background:white;
    color:black;
    padding:25px;
    border-radius:20px;
    box-shadow:0 10px 30px rgba(0,0,0,0.3);
}
input,button{
    padding:10px;
    margin:8px;
    border-radius:10px;
    border:none;
    font-size:16px;
}
button{
    background:#3498db;
    color:white;
    cursor:pointer;
}
.footer{
    margin-top:15px;
    font-size:12px;
}
</style>
</head>
<body>

<div class="container">
<h2>üå´ Healthy Air Smart Monitor</h2>

<div class="card">

<div id="location">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</div>

<input type="text" id="cityInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÄ‡∏ä‡πà‡∏ô Bangkok">
<br>
<button onclick="searchCity()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
<button onclick="init()">üìç ‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>

<div id="result">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
<button onclick="refreshData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>

</div>

<div class="footer">
Data source: WAQI API
</div>

</div>

<script>
const apiKey="05dc64914ef2d1b7c4d2678a15450338e660ea53";
let currentLat=null;
let currentLon=null;
let currentCity=null;

async function fetchData(url){
    const response=await fetch(url);
    const data=await response.json();
    if(data.status!=="ok") throw new Error("API error");
    return data;
}

function getLevel(pm25){
    if(pm25<=25) return {
        level:"‡∏î‡∏µ‡∏°‡∏≤‡∏Å üòä",
        color:"#2ecc71",
        advice:"‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥"
    };
    if(pm25<=50) return {
        level:"‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üòê",
        color:"#f1c40f",
        advice:"‡∏Ñ‡∏ß‡∏£‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô"
    };
    if(pm25<=90) return {
        level:"‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö üò∑",
        color:"#e67e22",
        advice:"‡∏Ñ‡∏ß‡∏£‡∏™‡∏ß‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å N95 ‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á"
    };
    return {
        level:"‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ üö®",
        color:"#e74c3c",
        advice:"‡∏Ñ‡∏ß‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏®"
    };
}

function notifyUser(pm25){
    if(Notification.permission==="granted"){
        new Notification("‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô PM2.5 ‡∏™‡∏π‡∏á",{
            body:`‡∏Ñ‡πà‡∏≤‡∏ù‡∏∏‡πà‡∏ô ${pm25} ¬µg/m¬≥ ‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏ô‡πÄ‡∏≠‡∏á`
        });
    }
}

function display(data){
    const pm25=data.data.iaqi.pm25?.v || 0;
    const aqi=data.data.aqi;
    const station=data.data.city.name;

    const info=getLevel(pm25);

    document.body.style.background=info.color;

    document.getElementById("location").innerHTML=
        `<strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ:</strong> ${station}`;

    document.getElementById("result").innerHTML=`
        <h1>${pm25} ¬µg/m¬≥</h1>
        <h3>AQI: ${aqi}</h3>
        <h3>${info.level}</h3>
        <p>${info.advice}</p>
    `;

    if(pm25>90) notifyUser(pm25);
}

async function getByGeo(lat,lon){
    const url=`https://api.waqi.info/feed/geo:${lat};${lon}/?token=${apiKey}`;
    const data=await fetchData(url);
    display(data);
}

async function searchCity(){
    const city=document.getElementById("cityInput").value;
    if(!city) return;
    currentCity=city;
    const url=`https://api.waqi.info/feed/${city}/?token=${apiKey}`;
    const data=await fetchData(url);
    display(data);
}

function refreshData(){
    if(currentLat && currentLon){
        getByGeo(currentLat,currentLon);
    }else if(currentCity){
        searchCity();
    }
}

function init(){
    if("Notification" in window){
        Notification.requestPermission();
    }

    if("geolocation" in navigator){
        navigator.geolocation.getCurrentPosition(pos=>{
            currentLat=pos.coords.latitude;
            currentLon=pos.coords.longitude;
            getByGeo(currentLat,currentLon);
        },()=>{
            document.getElementById("location").innerHTML=
                "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ";
        });
    }
}

init();
</script>

</body>
</html>
