<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ« Thailand PM2.5 Dashboard</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    font-family:'Prompt',sans-serif;
    background:linear-gradient(135deg,#1e3c72,#2a5298);
    color:#333;
}

header{
    text-align:center;
    padding:20px;
    font-size:22px;
    font-weight:bold;
    color:white;
}

.container{
    padding:15px;
}

.card{
    background:white;
    padding:18px;
    border-radius:16px;
    margin-bottom:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
}

h3{
    margin-top:0;
}

#map{
    height:350px;
    border-radius:12px;
}

table{
    width:100%;
    border-collapse:collapse;
}

th{
    background:linear-gradient(90deg,#4facfe,#00f2fe);
    color:white;
    padding:10px;
}

td{
    padding:8px;
    border-bottom:1px solid #eee;
    text-align:center;
}

.top1{background:#ffcccc;}
.top2{background:#ffe0b3;}
.top3{background:#fff3cd;}

.loading{
    animation:pulse 1.5s infinite;
    background:#eee;
    height:20px;
    border-radius:5px;
}

@keyframes pulse{
    0%{opacity:1}
    50%{opacity:0.4}
    100%{opacity:1}
}
</style>
</head>

<body>

<header>
ğŸŒ« Thailand PM2.5 Dashboard ğŸ‡¹ğŸ‡­  
<div style="font-size:14px;">à¸­à¸±à¸›à¹€à¸”à¸•à¸¥à¹ˆà¸²à¸ªà¸¸à¸”: <span id="updateTime">...</span></div>
</header>

<div class="container">

<div class="card">
<h3>ğŸ† Top 10 à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸„à¹ˆà¸²à¸à¸¸à¹ˆà¸™à¸ªà¸¹à¸‡à¸ªà¸¸à¸”</h3>
<table>
<thead>
<tr>
<th>à¸­à¸±à¸™à¸”à¸±à¸š</th>
<th>à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”</th>
<th>PM2.5 (Âµg/mÂ³)</th>
</tr>
</thead>
<tbody id="topTable">
<tr><td colspan="3"><div class="loading"></div></td></tr>
</tbody>
</table>
</div>

<div class="card">
<h3>ğŸ“Š à¸à¸£à¸²à¸Ÿ Top 10</h3>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h3>ğŸ—º à¹à¸œà¸™à¸—à¸µà¹ˆà¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸—à¸¢</h3>
<div id="map"></div>
</div>

<div class="card">
<h3>ğŸ©º à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸ªà¸¸à¸‚à¸ à¸²à¸</h3>
<p id="advice">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...</p>
</div>

</div>

<script>

// à¹ƒà¸ªà¹ˆ API à¸ˆà¸£à¸´à¸‡
const API_URL="https://example.com/pm25.json";

let allData=[];
let chart;

fetch(API_URL)
.then(res=>res.json())
.then(data=>{
    allData=data.sort((a,b)=>b.pm25-a.pm25);
    renderTop10();
    renderChart();
    showAdvice();
    document.getElementById("updateTime").innerText=
        new Date().toLocaleString();
    loadMap(); // à¹‚à¸«à¸¥à¸”à¹à¸œà¸™à¸—à¸µà¹ˆà¸—à¸µà¸«à¸¥à¸±à¸‡
});

// ===== Top 10 =====
function renderTop10(){
    const tbody=document.getElementById("topTable");
    tbody.innerHTML="";
    allData.slice(0,10).forEach((d,i)=>{
        let rowClass="";
        if(i===0) rowClass="top1";
        else if(i===1) rowClass="top2";
        else if(i===2) rowClass="top3";

        tbody.innerHTML+=`
        <tr class="${rowClass}">
        <td>${i+1}</td>
        <td>${d.province}</td>
        <td>${d.pm25}</td>
        </tr>`;
    });
}

// ===== Chart =====
function renderChart(){
    chart=new Chart(document.getElementById("chart"),{
        type:'bar',
        data:{
            labels:allData.slice(0,10).map(d=>d.province),
            datasets:[{
                label:'PM2.5 Âµg/mÂ³',
                data:allData.slice(0,10).map(d=>d.pm25)
            }]
        }
    });
}

// ===== Advice =====
function showAdvice(){
    let pm=allData[0].pm25;
    let text="";

    if(pm<=25) text="ğŸ˜Š à¸­à¸²à¸à¸²à¸¨à¸”à¸µ à¸—à¸³à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸à¸¥à¸²à¸‡à¹à¸ˆà¹‰à¸‡à¹„à¸”à¹‰";
    else if(pm<=50) text="ğŸ˜· à¸à¸¥à¸¸à¹ˆà¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¸„à¸§à¸£à¸¥à¸”à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸à¸¥à¸²à¸‡à¹à¸ˆà¹‰à¸‡";
    else if(pm<=75) text="âš  à¸„à¸§à¸£à¸ªà¸§à¸¡à¸«à¸™à¹‰à¸²à¸à¸²à¸ N95";
    else text="ğŸš¨ à¸­à¸±à¸™à¸•à¸£à¸²à¸¢! à¸„à¸§à¸£à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸­à¸²à¸„à¸²à¸£à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸Ÿà¸­à¸à¸­à¸²à¸à¸²à¸¨";

    document.getElementById("advice").innerText=text;
}

// ===== Load Map Late =====
function loadMap(){
    const script=document.createElement("script");
    script.src="https://unpkg.com/leaflet/dist/leaflet.js";
    script.onload=initMap;
    document.body.appendChild(script);
}

function initMap(){
    let map=L.map('map').setView([13.7367,100.5231],6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
    .addTo(map);

    allData.forEach(d=>{
        L.circle([d.lat,d.lon],{
            radius:8000,
            color:d.pm25>75?"red":"orange"
        }).addTo(map)
        .bindPopup(`${d.province} : ${d.pm25}`);
    });
}

// ===== Auto Refresh à¸—à¸¸à¸ 5 à¸™à¸²à¸—à¸µ =====
setInterval(()=>{
    location.reload();
},300000);

</script>

</body>
</html>
